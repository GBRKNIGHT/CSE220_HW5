#include "unit_tests.h"

TestSuite(grading_output, .timeout=TEST_TIMEOUT);
TestSuite(grading_return, .timeout=TEST_TIMEOUT);
TestSuite(grading_valgrind, .timeout=TEST_TIMEOUT);

Test(grading_output, print_packet01, .description="Print the contents of a packet") {
    char *test_name = "grading_print_packet01";
    run_using_system_no_valgrind(test_name); 
    expect_outfile_matches(test_name);
}

// Should have instead used hex codes for ASCII characters because at least one of you clever students used isxdigit().
Test(grading_return, checksum01, .description="Compute a checksum") {
    unsigned char packet[] = "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x3c\x03\x1f\x00\x00\x24\xff\x7e\x12\x42\x69\x72\x64\x20\x6f\x6e\x65\x20\x77\x6f\x72\x6bUH OH YOU MESSED UP";
    unsigned int actual = checksum_sf(packet);
    unsigned int expected =  0x1454db90;
    report_return_value(actual, expected);
}

Test(grading_output, packetize01, .description="Packetize a short message. packets[] is the optimal length.") {
    char msg[] = "There are two ways to write error-free programs; only the third one works. - Alan J. Perlis";
    unsigned char *packets_act[8];
    unsigned int packets_len = 8;
    unsigned int max_payload = 12;
    unsigned long src_addr =  0x38918a2731L;
    unsigned long dest_addr = 0x1e82cab029L;
    unsigned short encryption = 799;

    char *packets_exp[] = {
        "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x00\x03\x1f\x00\x00\x24\x14\x54\xdb\x54\x54\x68\x65\x72\x65\x20\x61\x72\x65\x20\x74\x77",
        "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x0c\x03\x1f\x00\x00\x24\x14\x54\xdb\x60\x6f\x20\x77\x61\x79\x73\x20\x74\x6f\x20\x77\x72",
        "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x18\x03\x1f\x00\x00\x24\x14\x54\xdb\x6c\x69\x74\x65\x20\x65\x72\x72\x6f\x72\x2d\x66\x72",
        "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x24\x03\x1f\x00\x00\x24\x14\x54\xdb\x78\x65\x65\x20\x70\x72\x6f\x67\x72\x61\x6d\x73\x3b",
        "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x30\x03\x1f\x00\x00\x24\x14\x54\xdb\x84\x20\x6f\x6e\x6c\x79\x20\x74\x68\x65\x20\x74\x68",
        "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x3c\x03\x1f\x00\x00\x24\x14\x54\xdb\x90\x69\x72\x64\x20\x6f\x6e\x65\x20\x77\x6f\x72\x6b",
        "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x48\x03\x1f\x00\x00\x24\x14\x54\xdb\x9c\x73\x2e\x20\x2d\x20\x41\x6c\x61\x6e\x20\x4a\x2e",
        "\x38\x91\x8a\x27\x31\x1e\x82\xca\xb0\x29\x20\x40\x00\x00\x54\x03\x1f\x00\x00\x1f\x14\x54\xdb\xa3\x20\x50\x65\x72\x6c\x69\x73",
    };
    unsigned int packet_lens_exp[] = {36, 36, 36, 36, 36, 36, 36, 31};
    packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 8;
    report_packets(packets_act, packets_exp, packet_lens_exp, num_packets_exp);
}
Test(grading_return, packetize01, .description="Packetize a short message. packets[] is the optimal length.") {
    char msg[] = "There are two ways to write error-free programs; only the third one works. - Alan J. Perlis";
    unsigned char *packets_act[8];
    unsigned int packets_len = 8;
    unsigned int max_payload = 12;
    unsigned long src_addr =  0x38918a2731L;
    unsigned long dest_addr = 0x1e82cab029L;
    unsigned short encryption = 799;
    unsigned int num_packets_act = packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 8;
    report_return_value(num_packets_act, num_packets_exp);
}
Test(grading_valgrind, packetize01) {
    expect_no_valgrind_errors(run_using_system("grading_packetize01"));
}

Test(grading_output, packetize02, .description="Message stored in one packet. max_payload smaller than needed.") {
    char msg[] = "C is quirky, flawed, and an enormous success. (Dennis Ritchie)";
    unsigned char *packets_act[1];
    unsigned int packets_len = 1;
    unsigned int max_payload = 60;
    unsigned long src_addr =  0x0091efc760L;
    unsigned long dest_addr = 0x821ecab029L;
    unsigned short encryption = 220;

    char *packets_exp[] = {
        "\x00\x91\xef\xc7\x60\x82\x1e\xca\xb0\x29\x20\x40\x00\x00\x00\x00\xdc\x00\x00\x54\xb0\xba\x79\x9b\x43\x20\x69\x73\x20\x71\x75\x69\x72\x6b\x79\x2c\x20\x66\x6c\x61\x77\x65\x64\x2c\x20\x61\x6e\x64\x20\x61\x6e\x20\x65\x6e\x6f\x72\x6d\x6f\x75\x73\x20\x73\x75\x63\x63\x65\x73\x73\x2e\x20\x28\x44\x65\x6e\x6e\x69\x73\x20\x52\x69\x74\x63\x68\x69",
    };
    unsigned int packet_lens_exp[] = {84};
    packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 1;
    report_packets(packets_act, packets_exp, packet_lens_exp, num_packets_exp);
}
Test(grading_return, packetize02, .description="Message stored in one packet. max_payload smaller than needed.") {
    char msg[] = "C is quirky, flawed, and an enormous success. (Dennis Ritchie)";
    unsigned char *packets_act[1];
    unsigned int packets_len = 1;
    unsigned int max_payload = 60;
    unsigned long src_addr =  0x0091efc760L;
    unsigned long dest_addr = 0x821ecab029L;
    unsigned short encryption = 220;
    unsigned int num_packets_act = packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 1;
    report_return_value(num_packets_act, num_packets_exp);
}
Test(grading_valgrind, packetize02) {
    expect_no_valgrind_errors(run_using_system("grading_packetize02"));
}

Test(grading_output, packetize03, .description="Message fits in one packet. max_payload larger than needed.") {
    char msg[] = "C is quirky, flawed, and an enormous success. (Dennis Ritchie)";
    unsigned char *packets_act[1];
    unsigned int packets_len = 1;
    unsigned int max_payload = 70;
    unsigned long src_addr =  0x0091efc760L;
    unsigned long dest_addr = 0x821ecab029L;
    unsigned short encryption = 220;
    
    char *packets_exp[] = {
        "\x00\x91\xef\xc7\x60\x82\x1e\xca\xb0\x29\x20\x40\x00\x00\x00\x00\xdc\x00\x00\x56\xb0\xba\x79\x9d\x43\x20\x69\x73\x20\x71\x75\x69\x72\x6b\x79\x2c\x20\x66\x6c\x61\x77\x65\x64\x2c\x20\x61\x6e\x64\x20\x61\x6e\x20\x65\x6e\x6f\x72\x6d\x6f\x75\x73\x20\x73\x75\x63\x63\x65\x73\x73\x2e\x20\x28\x44\x65\x6e\x6e\x69\x73\x20\x52\x69\x74\x63\x68\x69\x65\x29",
    };
    unsigned int packet_lens_exp[] = {86};
    packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 1;
    report_packets(packets_act, packets_exp, packet_lens_exp, num_packets_exp);
}
Test(grading_return, packetize03, .description="Message fits in one packet. max_payload larger than needed.") {
    char msg[] = "C is quirky, flawed, and an enormous success. (Dennis Ritchie)";
    unsigned char *packets_act[1];
    unsigned int packets_len = 1;
    unsigned int max_payload = 70;
    unsigned long src_addr =  0x0091efc760L;
    unsigned long dest_addr = 0x821ecab029L;
    unsigned short encryption = 220;
    unsigned int num_packets_act = packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 1;
    report_return_value(num_packets_act, num_packets_exp);
}
Test(grading_valgrind, packetize03) {
    expect_no_valgrind_errors(run_using_system("grading_packetize03"));
}

Test(grading_output, packetize04, .description="Message fits in one packet. max_payload exactly the right size.") {
    char msg[] = "C is quirky, flawed, and an enormous success. (Dennis Ritchie)";
    unsigned char *packets_act[1];
    unsigned int packets_len = 1;
    unsigned int max_payload = 62;
    unsigned long src_addr =  0x91e00fc760L;
    unsigned long dest_addr = 0x8217212329L;
    unsigned short encryption = 4400;
    
    char *packets_exp[] = {
        "\x91\xe0\x0f\xc7\x60\x82\x17\x21\x23\x29\x20\x40\x00\x00\x00\x11\x30\x00\x00\x56\xf7\x30\xfd\x82\x43\x20\x69\x73\x20\x71\x75\x69\x72\x6b\x79\x2c\x20\x66\x6c\x61\x77\x65\x64\x2c\x20\x61\x6e\x64\x20\x61\x6e\x20\x65\x6e\x6f\x72\x6d\x6f\x75\x73\x20\x73\x75\x63\x63\x65\x73\x73\x2e\x20\x28\x44\x65\x6e\x6e\x69\x73\x20\x52\x69\x74\x63\x68\x69\x65\x29",
    };
    unsigned int packet_lens_exp[] = {86};
    packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 1;
    report_packets(packets_act, packets_exp, packet_lens_exp, num_packets_exp);
}
Test(grading_return, packetize04, .description="Message fits in one packet. max_payload exactly the right size.") {
    char msg[] = "C is quirky, flawed, and an enormous success. (Dennis Ritchie)";
    unsigned char *packets_act[1];
    unsigned int packets_len = 1;
    unsigned int max_payload = 62;
    unsigned long src_addr =  0x91e00fc760L;
    unsigned long dest_addr = 0x8217212329L;
    unsigned short encryption = 4400;
    unsigned int num_packets_act = packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 1;
    report_return_value(num_packets_act, num_packets_exp);
}
Test(grading_valgrind, packetize04) {
    expect_no_valgrind_errors(run_using_system("grading_packetize04"));
}

Test(grading_output, packetize05, .description="Message fits in one packet plus one extra packet for final character of message.") {
    char msg[] = "If Java had true garbage collection, most programs would delete themselves upon execution. *Robert Sewell*";
    unsigned char *packets_act[2];
    unsigned int packets_len = 2;
    unsigned int max_payload = 105;
    unsigned long src_addr =  0x6316322456L;
    unsigned long dest_addr = 0x80032cdabfL;
    unsigned short encryption = 11794;
    
    char *packets_exp[] = {
        "\x63\x16\x32\x24\x56\x80\x03\x2c\xda\xbf\x20\x40\x00\x00\x00\x2e\x12\x00\x00\x81\x19\x5f\x2e\xeb\x49\x66\x20\x4a\x61\x76\x61\x20\x68\x61\x64\x20\x74\x72\x75\x65\x20\x67\x61\x72\x62\x61\x67\x65\x20\x63\x6f\x6c\x6c\x65\x63\x74\x69\x6f\x6e\x2c\x20\x6d\x6f\x73\x74\x20\x70\x72\x6f\x67\x72\x61\x6d\x73\x20\x77\x6f\x75\x6c\x64\x20\x64\x65\x6c\x65\x74\x65\x20\x74\x68\x65\x6d\x73\x65\x6c\x76\x65\x73\x20\x75\x70\x6f\x6e\x20\x65\x78\x65\x63\x75\x74\x69\x6f\x6e\x2e\x20\x2a\x52\x6f\x62\x65\x72\x74\x20\x53\x65\x77\x65\x6c\x6c",
        "\x63\x16\x32\x24\x56\x80\x03\x2c\xda\xbf\x20\x40\x00\x00\x69\x2e\x12\x00\x00\x19\x19\x5f\x2e\xec\x2a",
    };
    unsigned int packet_lens_exp[] = {129, 25};
    packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 2;
    report_packets(packets_act, packets_exp, packet_lens_exp, num_packets_exp);
}
Test(grading_return, packetize05, .description="Message fits in one packet plus one extra packet for final character of message.") {
    char msg[] = "If Java had true garbage collection, most programs would delete themselves upon execution. *Robert Sewell*";
    unsigned char *packets_act[2];
    unsigned int packets_len = 2;
    unsigned int max_payload = 105;
    unsigned long src_addr =  0x6316322456L;
    unsigned long dest_addr = 0x80032cdabfL;
    unsigned short encryption = 11794;
    unsigned int num_packets_act = packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 2;
    report_return_value(num_packets_act, num_packets_exp);
}
Test(grading_valgrind, packetize05) {
    expect_no_valgrind_errors(run_using_system("grading_packetize05"));
}

Test(grading_output, packetize06, .description="Message split across multiple packets. packets[] is longer than needed.") {
    char msg[] = "If Java had true garbage collection, most programs would delete themselves upon execution. *Robert Sewell*";
    unsigned char *packets_act[50];
    unsigned int packets_len = 50;
    unsigned int max_payload = 25;
    unsigned long src_addr =  0x6316322456L;
    unsigned long dest_addr = 0x80032cdabfL;
    unsigned short encryption = 11794;
    char *packets_exp[] = {
        "\x63\x16\x32\x24\x56\x80\x03\x2c\xda\xbf\x20\x40\x00\x00\x00\x2e\x12\x00\x00\x31\x19\x5f\x2e\x9b\x49\x66\x20\x4a\x61\x76\x61\x20\x68\x61\x64\x20\x74\x72\x75\x65\x20\x67\x61\x72\x62\x61\x67\x65\x20",
        "\x63\x16\x32\x24\x56\x80\x03\x2c\xda\xbf\x20\x40\x00\x00\x19\x2e\x12\x00\x00\x31\x19\x5f\x2e\xb4\x63\x6f\x6c\x6c\x65\x63\x74\x69\x6f\x6e\x2c\x20\x6d\x6f\x73\x74\x20\x70\x72\x6f\x67\x72\x61\x6d\x73",
        "\x63\x16\x32\x24\x56\x80\x03\x2c\xda\xbf\x20\x40\x00\x00\x32\x2e\x12\x00\x00\x31\x19\x5f\x2e\xcd\x20\x77\x6f\x75\x6c\x64\x20\x64\x65\x6c\x65\x74\x65\x20\x74\x68\x65\x6d\x73\x65\x6c\x76\x65\x73\x20",
        "\x63\x16\x32\x24\x56\x80\x03\x2c\xda\xbf\x20\x40\x00\x00\x4b\x2e\x12\x00\x00\x31\x19\x5f\x2e\xe6\x75\x70\x6f\x6e\x20\x65\x78\x65\x63\x75\x74\x69\x6f\x6e\x2e\x20\x2a\x52\x6f\x62\x65\x72\x74\x20\x53",
        "\x63\x16\x32\x24\x56\x80\x03\x2c\xda\xbf\x20\x40\x00\x00\x64\x2e\x12\x00\x00\x1e\x19\x5f\x2e\xec\x65\x77\x65\x6c\x6c\x2a",
    };
    unsigned int packet_lens_exp[] = {49, 49, 49, 49, 30, };
    packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 5;
    report_packets(packets_act, packets_exp, packet_lens_exp, num_packets_exp);
}
Test(grading_return, packetize06, .description="Message split across multiple packets. packets[] is longer than needed.") {
    char msg[] = "If Java had true garbage collection, most programs would delete themselves upon execution. *Robert Sewell*";
    unsigned char *packets_act[50];
    unsigned int packets_len = 50;
    unsigned int max_payload = 25;
    unsigned long src_addr =  0x6316322456L;
    unsigned long dest_addr = 0x80032cdabfL;
    unsigned short encryption = 11794;
    unsigned int num_packets_act = packetize_sf(msg, packets_act, packets_len, max_payload, src_addr, dest_addr, encryption);
    unsigned int num_packets_exp = 5;
    report_return_value(num_packets_act, num_packets_exp);
}
Test(grading_valgrind, packetize06) {
    expect_no_valgrind_errors(run_using_system("grading_packetize06"));
}

Test(grading_output, reconstruct01, .description="Function given more than enough memory to store the entire message.") {
    char *packets[] = {
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x32\x02\x14\x00\x00\x2b\x8e\x9f\x02\x4a\x79\x20\x67\x69\x76\x65\x20\x79\x6f\x75\x20\x61\x6e\x73\x77\x65\x72\x73\x2e",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x00\x02\x14\x00\x00\x31\x8e\x9f\x02\x1e\x50\x61\x62\x6c\x6f\x20\x50\x69\x63\x61\x73\x73\x6f\x3a\x20\x43\x6f\x6d\x70\x75\x74\x65\x72\x73\x20",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x19\x02\x14\x00\x00\x31\x8e\x9f\x02\x37\x61\x72\x65\x20\x75\x73\x65\x6c\x65\x73\x73\x2e\x20\x54\x68\x65\x79\x20\x63\x61\x6e\x20\x6f\x6e\x6c",
    };
    unsigned int packets_len = 3;
    unsigned int message_len = 75;  // original message has 69 characters
    char *message_act = malloc(message_len*sizeof(char));

    // fill memory with "random" garbage
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = '*'; 

    reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    char *message_exp = "Pablo Picasso: Computers are useless. They can only give you answers.";
    cr_expect_arr_eq(message_act, message_exp, strlen(message_exp)+1,
            "Contents of message incorrect.\nActual:   %s\nExpected: %s", message_act, message_exp);
    free(message_act);
}
Test(grading_return, reconstruct01, .description="Function given more than enough memory to store the entire message.") {
    char *packets[] = {
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x32\x02\x14\x00\x00\x2b\x8e\x9f\x02\x4a\x79\x20\x67\x69\x76\x65\x20\x79\x6f\x75\x20\x61\x6e\x73\x77\x65\x72\x73\x2e",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x00\x02\x14\x00\x00\x31\x8e\x9f\x02\x1e\x50\x61\x62\x6c\x6f\x20\x50\x69\x63\x61\x73\x73\x6f\x3a\x20\x43\x6f\x6d\x70\x75\x74\x65\x72\x73\x20",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x19\x02\x14\x00\x00\x31\x8e\x9f\x02\x37\x61\x72\x65\x20\x75\x73\x65\x6c\x65\x73\x73\x2e\x20\x54\x68\x65\x79\x20\x63\x61\x6e\x20\x6f\x6e\x6c",
    };
    unsigned int packets_len = 3;
    unsigned int message_len = 75;  // original message has 69 characters
    char *message_act = malloc(message_len*sizeof(char));

    // fill memory with "random" garbage
    srand(4321);
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    unsigned int num_packets_act = reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    unsigned int num_packets_exp = 3;
    report_return_value(num_packets_act, num_packets_exp);
    free(message_act);
}
Test(grading_valgrind, reconstruct01) {
    expect_no_valgrind_errors(run_using_system("grading_reconstruct01"));
}

Test(grading_output, reconstruct02, .description="Function given exactly enough memory to store the entire message.") {
    char *packets[] = {
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x13\x02\x14\x00\x00\x2b\x8e\x9f\x02\x2b\x77\x69\x6e\x65\x2e\x20\x53\x6f\x6d\x65\x74\x69\x6d\x65\x73\x20\x49\x20\x65",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x39\x02\x14\x00\x00\x2b\x8e\x9f\x02\x51\x6f\x6f\x64\x2e\x20\x20\x2d\x57\x2e\x43\x2e\x20\x46\x69\x65\x6c\x64\x73\x2d",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x00\x02\x14\x00\x00\x2b\x8e\x9f\x02\x18\x49\x20\x61\x6c\x77\x61\x79\x73\x20\x63\x6f\x6f\x6b\x20\x77\x69\x74\x68\x20",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x26\x02\x14\x00\x00\x2b\x8e\x9f\x02\x3e\x76\x65\x6e\x20\x61\x64\x64\x20\x69\x74\x20\x74\x6f\x20\x74\x68\x65\x20\x66",
    };
    unsigned int packets_len = 4;
    unsigned int message_len = 77;  // original message has 76 characters
    char *message_act = malloc(message_len+3);

    // fill memory with "random" garbage
    srand(444);
    for (unsigned int i = 0; i < message_len+3; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    char *message_exp = "I always cook with wine. Sometimes I even add it to the food.  -W.C. Fields-";
    cr_expect_arr_eq(message_act, message_exp, strlen(message_exp)+1,
            "Contents of message incorrect.\nActual:   %s\nExpected: %s", message_act, message_exp);
    free(message_act);
}
Test(grading_return, reconstruct02, .description="Function given exactly enough memory to store the entire message.") {
    char *packets[] = {
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x13\x02\x14\x00\x00\x2b\x8e\x9f\x02\x2b\x77\x69\x6e\x65\x2e\x20\x53\x6f\x6d\x65\x74\x69\x6d\x65\x73\x20\x49\x20\x65",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x39\x02\x14\x00\x00\x2b\x8e\x9f\x02\x51\x6f\x6f\x64\x2e\x20\x20\x2d\x57\x2e\x43\x2e\x20\x46\x69\x65\x6c\x64\x73\x2d",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x00\x02\x14\x00\x00\x2b\x8e\x9f\x02\x18\x49\x20\x61\x6c\x77\x61\x79\x73\x20\x63\x6f\x6f\x6b\x20\x77\x69\x74\x68\x20",
        "\x63\xff\xf2\x24\x56\x00\x8e\xac\xda\xbf\x20\x40\x00\x00\x26\x02\x14\x00\x00\x2b\x8e\x9f\x02\x3e\x76\x65\x6e\x20\x61\x64\x64\x20\x69\x74\x20\x74\x6f\x20\x74\x68\x65\x20\x66",
    };
    unsigned int packets_len = 4;
    unsigned int message_len = 77;  // original message has 76 characters
    char *message_act = malloc(message_len*sizeof(char));

    // fill memory with "random" garbage
    srand(444);
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    unsigned int num_packets_act = reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    unsigned int num_packets_exp = 4;
    report_return_value(num_packets_act, num_packets_exp);
    free(message_act);
}
Test(grading_valgrind, reconstruct02) {
    expect_no_valgrind_errors(run_using_system("grading_reconstruct02"));
}

Test(grading_output, reconstruct03, .description="Function given a few bytes byte of memory less than needed to store the entire message.") {
    char *packets[] = {
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x36\x00\x92\x00\x00\x2a\xed\xce\x2b\xdf\x69\x66\x66\x65\x72\x65\x6e\x74\x20\x70\x65\x72\x73\x6f\x6e\x20\x74\x68",        
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x00\x00\x92\x00\x00\x2a\xed\xce\x2b\xa9\x49\x74\x27\x73\x20\x6e\x6f\x20\x75\x73\x65\x20\x67\x6f\x69\x6e\x67\x20",
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x48\x00\x92\x00\x00\x2a\xed\xce\x2b\xf1\x65\x6e\x2e\x20\x2a\x4c\x65\x77\x69\x73\x20\x43\x61\x72\x72\x6f\x6c\x6c",
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x5a\x00\x92\x00\x00\x19\xed\xce\x2b\xf2\x2a",
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x12\x00\x92\x00\x00\x2a\xed\xce\x2b\xbb\x62\x61\x63\x6b\x20\x74\x6f\x20\x79\x65\x73\x74\x65\x72\x64\x61\x79\x2c",
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x24\x00\x92\x00\x00\x2a\xed\xce\x2b\xcd\x20\x62\x65\x63\x61\x75\x73\x65\x20\x49\x20\x77\x61\x73\x20\x61\x20\x64",
    };
    unsigned int packets_len = 6;
    unsigned int message_len = 85;  // original message has 90 characters. 
    char *message_act = malloc(message_len+3);

    // fill memory with "random" garbage
    srand(23456);
    for (unsigned int i = 0; i < message_len+3; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    char *message_exp = "It's no use going back to yesterday, because I was a different person then. *Lewis C";
    report_message(message_act, message_exp);
    free(message_act);
}
Test(grading_return, reconstruct03, .description="Function given a few bytes of memory less than needed to store the entire message.") {
        char *packets[] = {
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x36\x00\x92\x00\x00\x2a\xed\xce\x2b\xdf\x69\x66\x66\x65\x72\x65\x6e\x74\x20\x70\x65\x72\x73\x6f\x6e\x20\x74\x68",        
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x00\x00\x92\x00\x00\x2a\xed\xce\x2b\xa9\x49\x74\x27\x73\x20\x6e\x6f\x20\x75\x73\x65\x20\x67\x6f\x69\x6e\x67\x20",
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x48\x00\x92\x00\x00\x2a\xed\xce\x2b\xf1\x65\x6e\x2e\x20\x2a\x4c\x65\x77\x69\x73\x20\x43\x61\x72\x72\x6f\x6c\x6c",
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x5a\x00\x92\x00\x00\x19\xed\xce\x2b\xf2\x2a",
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x12\x00\x92\x00\x00\x2a\xed\xce\x2b\xbb\x62\x61\x63\x6b\x20\x74\x6f\x20\x79\x65\x73\x74\x65\x72\x64\x61\x79\x2c",
        "\x00\x98\x21\x4f\xce\x00\x55\xac\xda\xbf\x20\x40\x00\x00\x24\x00\x92\x00\x00\x2a\xed\xce\x2b\xcd\x20\x62\x65\x63\x61\x75\x73\x65\x20\x49\x20\x77\x61\x73\x20\x61\x20\x64",
    };
    unsigned int packets_len = 6;
    unsigned int message_len = 85;  // original message has 91 characters. 
    char *message_act = malloc(message_len+3);

    // fill memory with "random" garbage
    srand(23456);
    for (unsigned int i = 0; i < message_len+3; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    unsigned int num_packets_act = reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    unsigned int num_packets_exp = 5;
    report_return_value(num_packets_act, num_packets_exp);
    free(message_act);
}
Test(grading_valgrind, reconstruct03) {
    expect_no_valgrind_errors(run_using_system("grading_reconstruct03"));
}

Test(grading_output, reconstruct04, .description="Function given only two bytes of memory to store the message.") {
    char *packets[] = {
        "\x00\x9c\xea\xdf\xce\x00\x55\xa0\x06\xbf\x20\x40\x00\x00\x1d\x00\xde\x00\x00\x35\xf2\x8a\xe8\x1d\x6e\x20\x66\x72\x61\x6d\x65\x77\x6f\x72\x6b\x20\x66\x6f\x72\x20\x62\x75\x69\x6c\x64\x69\x6e\x67\x20\x64\x79\x6e\x61",
        "\x00\x9c\xea\xdf\xce\x00\x55\xa0\x06\xbf\x20\x40\x00\x00\x00\x00\xde\x00\x00\x35\xf2\x8a\xe8\x00\x56\x61\x6c\x67\x72\x69\x6e\x64\x20\x69\x73\x20\x61\x6e\x20\x69\x6e\x73\x74\x72\x75\x6d\x65\x6e\x74\x61\x74\x69\x6f",
        "\x00\x9c\xea\xdf\xce\x00\x55\xa0\x06\xbf\x20\x40\x00\x00\x3a\x00\xde\x00\x00\x2b\xf2\x8a\xe8\x30\x6d\x69\x63\x20\x61\x6e\x61\x6c\x79\x73\x69\x73\x20\x74\x6f\x6f\x6c\x73\x2e",
    };
    unsigned int packets_len = 3;
    unsigned int message_len = 2;  
    char *message_act = malloc(message_len+3);

    // fill memory with "random" garbage
    srand(412);
    for (unsigned int i = 0; i < message_len+3; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    char *message_exp = "V";
    report_message(message_act, message_exp);
    free(message_act);
}
Test(grading_return, reconstruct04, .description="Function given only two bytes of memory to store the message.") {
    char *packets[] = {
        "\x00\x9c\xea\xdf\xce\x00\x55\xa0\x06\xbf\x20\x40\x00\x00\x1d\x00\xde\x00\x00\x35\xf2\x8a\xe8\x1d\x6e\x20\x66\x72\x61\x6d\x65\x77\x6f\x72\x6b\x20\x66\x6f\x72\x20\x62\x75\x69\x6c\x64\x69\x6e\x67\x20\x64\x79\x6e\x61",
        "\x00\x9c\xea\xdf\xce\x00\x55\xa0\x06\xbf\x20\x40\x00\x00\x00\x00\xde\x00\x00\x35\xf2\x8a\xe8\x00\x56\x61\x6c\x67\x72\x69\x6e\x64\x20\x69\x73\x20\x61\x6e\x20\x69\x6e\x73\x74\x72\x75\x6d\x65\x6e\x74\x61\x74\x69\x6f",
        "\x00\x9c\xea\xdf\xce\x00\x55\xa0\x06\xbf\x20\x40\x00\x00\x3a\x00\xde\x00\x00\x2b\xf2\x8a\xe8\x30\x6d\x69\x63\x20\x61\x6e\x61\x6c\x79\x73\x69\x73\x20\x74\x6f\x6f\x6c\x73\x2e",
    };
    unsigned int packets_len = 3;
    unsigned int message_len = 2;  
    char *message_act = malloc(message_len+3);

    // fill memory with "random" garbage
    srand(412);
    for (unsigned int i = 0; i < message_len+3; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    unsigned int num_packets_act = reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    unsigned int num_packets_exp = 1;
    report_return_value(num_packets_act, num_packets_exp);
    free(message_act);
}
Test(grading_valgrind, reconstruct04) {
    expect_no_valgrind_errors(run_using_system("grading_reconstruct04"));
}

Test(grading_output, reconstruct05, .description="Function not given enough memory to store the entire message, and first packet corrupted.") {
    char *packets[] = {
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x24\x01\x41\x00\x00\x21\xa0\x0c\xe8\x85\x73\x6b\x79\x64\x69\x76\x69\x6e\x67",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x2d\x01\x41\x00\x00\x21\xa0\x0c\xe8\x8e\x20\x69\x73\x6e\x27\x74\x20\x66\x6f",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x00\x01\x41\x00\x00\x21\xa1\x0c\xe8\x61\x49\x66\x20\x61\x74\x20\x66\x69\x72",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x48\x01\x41\x00\x00\x1b\xa0\x0c\xe8\xa3\x67\x68\x74",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x09\x01\x41\x00\x00\x21\xa0\x0c\xe8\x6a\x73\x74\x20\x79\x6f\x75\x20\x64\x6f",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x1b\x01\x41\x00\x00\x21\xa0\x0c\xe8\x7c\x65\x64\x2c\x20\x74\x68\x65\x6e\x20",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x12\x01\x41\x00\x00\x21\xa0\x0c\xe8\x73\x6e\x27\x74\x20\x73\x75\x63\x63\x65",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x36\x01\x41\x00\x00\x21\xa0\x0c\xe8\x97\x72\x20\x79\x6f\x75\x2e\x20\x2d\x53",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x3f\x01\x41\x00\x00\x21\xa0\x0c\xe8\xa0\x74\x65\x76\x65\x6e\x20\x57\x72\x69",
    };
    unsigned int packets_len = 9;
    unsigned int message_len = 51;  
    char *message_act = malloc(message_len+3);

    // fill memory with "random" garbage
    for (unsigned int i = 0; i < message_len+3; i++)
        message_act[i] = '&';

    reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    char *message_exp = "&&&&&&&&&st you don't succeed, then skydiving isn'";
    report_message(message_act, message_exp);
    free(message_act);
}
Test(grading_return, reconstruct05, .description="Function not given enough memory to store the entire message, and first packet corrupted.") {
    char *packets[] = {
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x24\x01\x41\x00\x00\x21\xa0\x0c\xe8\x85\x73\x6b\x79\x64\x69\x76\x69\x6e\x67",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x2d\x01\x41\x00\x00\x21\xa0\x0c\xe8\x8e\x20\x69\x73\x6e\x27\x74\x20\x66\x6f",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x00\x01\x41\x00\x00\x21\xa1\x0c\xe8\x61\x49\x66\x20\x61\x74\x20\x66\x69\x72",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x48\x01\x41\x00\x00\x1b\xa0\x0c\xe8\xa3\x67\x68\x74",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x09\x01\x41\x00\x00\x21\xa0\x0c\xe8\x6a\x73\x74\x20\x79\x6f\x75\x20\x64\x6f",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x1b\x01\x41\x00\x00\x21\xa0\x0c\xe8\x7c\x65\x64\x2c\x20\x74\x68\x65\x6e\x20",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x12\x01\x41\x00\x00\x21\xa0\x0c\xe8\x73\x6e\x27\x74\x20\x73\x75\x63\x63\x65",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x36\x01\x41\x00\x00\x21\xa0\x0c\xe8\x97\x72\x20\x79\x6f\x75\x2e\x20\x2d\x53",
        "\x09\xff\xea\xdf\xce\x08\xa0\x22\x06\xbf\x20\x40\x00\x00\x3f\x01\x41\x00\x00\x21\xa0\x0c\xe8\xa0\x74\x65\x76\x65\x6e\x20\x57\x72\x69",
    };
    unsigned int packets_len = 9;
    unsigned int message_len = 51;  
    char *message_act = malloc(message_len+3);

    // fill memory with "random" garbage
    for (unsigned int i = 0; i < message_len+3; i++)
        message_act[i] = '&';

    unsigned int num_packets_act = reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    unsigned int num_packets_exp = 5;
    report_return_value(num_packets_act, num_packets_exp);
    free(message_act);
}
Test(grading_valgrind, reconstruct05) {
    expect_no_valgrind_errors(run_using_system("grading_reconstruct05"));
}

Test(grading_output, reconstruct06, .description="Function given more memory than needed, but last two packets are corrupted.") {
    char *packets[] = {
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x2c\x03\x78\x00\x00\x2e\xe8\x0c\xea\xc6\x63\x69\x65\x6e\x74\x69\x73\x74\x2c\x20\x6d\x61\x74\x68\x65\x6d\x61\x74\x69\x63\x69\x61",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x00\x03\x78\x00\x00\x2e\xe8\x0c\xea\x9a\x44\x6f\x6e\x61\x6c\x64\x20\x45\x72\x76\x69\x6e\x20\x4b\x6e\x75\x74\x68\x20\x69\x73\x20",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x33\x03\x78\x00\x00\x1d\xe8\x0c\xea\xf7\x73\x69\x74\x79\x2e",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x16\x03\x78\x00\x00\x2e\xe8\x0c\xea\xb0\x61\x6e\x20\x41\x6d\x65\x72\x69\x63\x61\x6e\x20\x63\x6f\x6d\x70\x75\x74\x65\x72\x20\x73",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x42\x03\x78\x00\x00\x2e\xe8\x0c\xea\xdc\x6e\x2c\x20\x61\x6e\x64\x20\x70\x72\x6f\x66\x65\x73\x73\x6f\x72\x20\x65\x6d\x65\x72\x69",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x58\x03\x78\x00\x00\xff\xe8\x0c\xea\xf2\x74\x75\x73\x20\x61\x74\x20\x53\x74\x61\x6e\x66\x6f\x72\x64\x20\x55\x6e\x69\x76\x65\x72",
    };
    unsigned int packets_len = 6;
    unsigned int message_len = 125;  // original message has 115 characters
    char *message_act = malloc(message_len+1);

    // fill memory with "random" garbage
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = '#';
    message_act[message_len] = '\0';

    reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    char *message_exp = "Donald Ervin Knuth is an American computer scientist, mathematician, and professor emeri";
    report_message(message_act, message_exp);
    free(message_act);
}
Test(grading_return, reconstruct06, .description="Function given more memory than needed, but last two packets are corrupted.") {
    char *packets[] = {
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x2c\x03\x78\x00\x00\x2e\xe8\x0c\xea\xc6\x63\x69\x65\x6e\x74\x69\x73\x74\x2c\x20\x6d\x61\x74\x68\x65\x6d\x61\x74\x69\x63\x69\x61",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x00\x03\x78\x00\x00\x2e\xe8\x0c\xea\x9a\x44\x6f\x6e\x61\x6c\x64\x20\x45\x72\x76\x69\x6e\x20\x4b\x6e\x75\x74\x68\x20\x69\x73\x20",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x33\x03\x78\x00\x00\x1d\xe8\x0c\xea\xf7\x73\x69\x74\x79\x2e",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x16\x03\x78\x00\x00\x2e\xe8\x0c\xea\xb0\x61\x6e\x20\x41\x6d\x65\x72\x69\x63\x61\x6e\x20\x63\x6f\x6d\x70\x75\x74\x65\x72\x20\x73",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x42\x03\x78\x00\x00\x2e\xe8\x0c\xea\xdc\x6e\x2c\x20\x61\x6e\x64\x20\x70\x72\x6f\x66\x65\x73\x73\x6f\x72\x20\x65\x6d\x65\x72\x69",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x58\x03\x78\x00\x00\xff\xe8\x0c\xea\xf2\x74\x75\x73\x20\x61\x74\x20\x53\x74\x61\x6e\x66\x6f\x72\x64\x20\x55\x6e\x69\x76\x65\x72",
    };
    unsigned int packets_len = 6;
    unsigned int message_len = 125;  // original message has 115 characters
    char *message_act = malloc(message_len+1);

    // fill memory with "random" garbage
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = '#';
    message_act[message_len] = '\0';

    unsigned int num_packets_act = reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    unsigned int num_packets_exp = 4;
    report_return_value(num_packets_act, num_packets_exp);
    free(message_act);
}
Test(grading_valgrind, reconstruct06) {
    expect_no_valgrind_errors(run_using_system("grading_reconstruct06"));
}

Test(grading_output, reconstruct07, .description="Function given more memory than needed, but packets 1, 3, 4 are corrupted.") {
    char *packets[] = {
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x16\x03\x78\x00\x00\x2e\xaa\x0c\xea\xb0\x61\x6e\x20\x41\x6d\x65\x72\x69\x63\x61\x6e\x20\x63\x6f\x6d\x70\x75\x74\x65\x72\x20\x73",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x00\x03\x78\x00\x00\x2e\xe8\x0c\xea\x9a\x44\x6f\x6e\x61\x6c\x64\x20\x45\x72\x76\x69\x6e\x20\x4b\x6e\x75\x74\x68\x20\x69\x73\x20",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x2c\x03\x78\x00\x00\x2e\xe8\x0c\xea\xc6\x63\x69\x65\x6e\x74\x69\x73\x74\x2c\x20\x6d\x61\x74\x68\x65\x6d\x61\x74\x69\x63\x69\x61",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x42\x03\x78\x00\x00\x2e\xab\x0c\xea\xdc\x6e\x2c\x20\x61\x6e\x64\x20\x70\x72\x6f\x66\x65\x73\x73\x6f\x72\x20\x65\x6d\x65\x72\x69",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x6e\x03\x78\x00\x00\x1d\xe8\x0c\xea\xf7\x73\x69\x74\x79\x2e",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x58\x03\x78\x00\x00\x2e\xcd\x0c\xea\xf2\x74\x75\x73\x20\x61\x74\x20\x53\x74\x61\x6e\x66\x6f\x72\x64\x20\x55\x6e\x69\x76\x65\x72",
    };
    unsigned int packets_len = 6;
    unsigned int message_len = 125;  // original message has 115 characters
    char *message_act = malloc(message_len*sizeof(char));

    // fill memory with "random" garbage
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = 'X';

    reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    char *message_exp = "Donald Ervin Knuth is XXXXXXXXXXXXXXXXXXXXXXcientist, mathematiciaXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXsity.";
    report_message(message_act, message_exp);
    free(message_act);
}
Test(grading_return, reconstruct07, .description="Function given more memory than needed, but packets 1, 3, 4 are corrupted.") {
    char *packets[] = {
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x16\x03\x78\x00\x00\x2e\xaa\x0c\xea\xb0\x61\x6e\x20\x41\x6d\x65\x72\x69\x63\x61\x6e\x20\x63\x6f\x6d\x70\x75\x74\x65\x72\x20\x73",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x00\x03\x78\x00\x00\x2e\xe8\x0c\xea\x9a\x44\x6f\x6e\x61\x6c\x64\x20\x45\x72\x76\x69\x6e\x20\x4b\x6e\x75\x74\x68\x20\x69\x73\x20",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x2c\x03\x78\x00\x00\x2e\xe8\x0c\xea\xc6\x63\x69\x65\x6e\x74\x69\x73\x74\x2c\x20\x6d\x61\x74\x68\x65\x6d\x61\x74\x69\x63\x69\x61",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x42\x03\x78\x00\x00\x2e\xab\x0c\xea\xdc\x6e\x2c\x20\x61\x6e\x64\x20\x70\x72\x6f\x66\x65\x73\x73\x6f\x72\x20\x65\x6d\x65\x72\x69",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x6e\x03\x78\x00\x00\x1d\xe8\x0c\xea\xf7\x73\x69\x74\x79\x2e",
        "\x00\x77\xea\xdf\xce\x07\x70\x22\x06\xbf\x20\x40\x00\x00\x58\x03\x78\x00\x00\x2e\xcd\x0c\xea\xf2\x74\x75\x73\x20\x61\x74\x20\x53\x74\x61\x6e\x66\x6f\x72\x64\x20\x55\x6e\x69\x76\x65\x72",
    };
    unsigned int packets_len = 6;
    unsigned int message_len = 125;  // original message has 115 characters
    char *message_act = malloc(message_len*sizeof(char));

    // fill memory with "random" garbage
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = 'X';

    unsigned int num_packets_act = reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    unsigned int num_packets_exp = 3;
    report_return_value(num_packets_act, num_packets_exp);
    free(message_act);
}
Test(grading_valgrind, reconstruct07) {
    expect_no_valgrind_errors(run_using_system("grading_reconstruct07"));
}

Test(grading_output, reconstruct08, .description="Function given more than enough memory to store the entire message.") {
    char *packets[] = {
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x57\x06\x1f\x00\x00\x35\xce\x44\x07\x4b\x74\x68\x61\x74\x20\x74\x68\x65\x72\x65\x20\x61\x72\x65\x20\x6f\x62\x76\x69\x6f\x75\x73\x6c\x79\x20\x6e\x6f\x20\x64",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x74\x06\x1f\x00\x00\x35\xce\x44\x07\x68\x65\x66\x69\x63\x69\x65\x6e\x63\x69\x65\x73\x2e\x20\x41\x6e\x64\x20\x74\x68\x65\x20\x6f\x74\x68\x65\x72\x20\x77\x61",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x00\x06\x1f\x00\x00\x35\xce\x44\x06\xf4\x54\x68\x65\x72\x65\x20\x61\x72\x65\x20\x74\x77\x6f\x20\x77\x61\x79\x73\x20\x6f\x66\x20\x63\x6f\x6e\x73\x74\x72\x75",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x91\x06\x1f\x00\x00\x35\xce\x44\x07\x85\x79\x20\x69\x73\x20\x74\x6f\x20\x6d\x61\x6b\x65\x20\x69\x74\x20\x73\x6f\x20\x63\x6f\x6d\x70\x6c\x69\x63\x61\x74\x65",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\xae\x06\x1f\x00\x00\x35\xce\x44\x07\xa2\x64\x20\x74\x68\x61\x74\x20\x74\x68\x65\x72\x65\x20\x61\x72\x65\x20\x6e\x6f\x20\x6f\x62\x76\x69\x6f\x75\x73\x20\x64",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\xcb\x06\x1f\x00\x00\x33\xce\x44\x07\xbd\x65\x66\x69\x63\x69\x65\x6e\x63\x69\x65\x73\x2e\x20\x28\x43\x2e\x41\x2e\x52\x2e\x20\x48\x6f\x61\x72\x65\x29",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x1d\x06\x1f\x00\x00\x35\xce\x44\x07\x11\x63\x74\x69\x6e\x67\x20\x61\x20\x73\x6f\x66\x74\x77\x61\x72\x65\x20\x64\x65\x73\x69\x67\x6e\x2e\x20\x20\x4f\x6e\x65",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x3a\x06\x1f\x00\x00\x35\xce\x44\x07\x2e\x20\x77\x61\x79\x20\x69\x73\x20\x74\x6f\x20\x6d\x61\x6b\x65\x20\x69\x74\x20\x73\x6f\x20\x73\x69\x6d\x70\x6c\x65\x20",
    };
    unsigned int packets_len = 8;
    unsigned int message_len = 300;  // original message has 230 characters
    char *message_act = malloc(message_len*sizeof(char));

    // fill memory with "random" garbage
    srand(4321);
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    char *message_exp = "There are two ways of constructing a software design.  One way is to make it so simple that there are obviously no deficiencies. And the other way is to make it so complicated that there are no obvious deficiencies. (C.A.R. Hoare)";
    cr_expect_arr_eq(message_act, message_exp, strlen(message_exp)+1,
            "Contents of message incorrect.\nActual:   %s\nExpected: %s", message_act, message_exp);
    free(message_act);
}
Test(grading_return, reconstruct08, .description="Function given more than enough memory to store the entire message.") {
    char *packets[] = {
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x57\x06\x1f\x00\x00\x35\xce\x44\x07\x4b\x74\x68\x61\x74\x20\x74\x68\x65\x72\x65\x20\x61\x72\x65\x20\x6f\x62\x76\x69\x6f\x75\x73\x6c\x79\x20\x6e\x6f\x20\x64",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x74\x06\x1f\x00\x00\x35\xce\x44\x07\x68\x65\x66\x69\x63\x69\x65\x6e\x63\x69\x65\x73\x2e\x20\x41\x6e\x64\x20\x74\x68\x65\x20\x6f\x74\x68\x65\x72\x20\x77\x61",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x00\x06\x1f\x00\x00\x35\xce\x44\x06\xf4\x54\x68\x65\x72\x65\x20\x61\x72\x65\x20\x74\x77\x6f\x20\x77\x61\x79\x73\x20\x6f\x66\x20\x63\x6f\x6e\x73\x74\x72\x75",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x91\x06\x1f\x00\x00\x35\xce\x44\x07\x85\x79\x20\x69\x73\x20\x74\x6f\x20\x6d\x61\x6b\x65\x20\x69\x74\x20\x73\x6f\x20\x63\x6f\x6d\x70\x6c\x69\x63\x61\x74\x65",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\xae\x06\x1f\x00\x00\x35\xce\x44\x07\xa2\x64\x20\x74\x68\x61\x74\x20\x74\x68\x65\x72\x65\x20\x61\x72\x65\x20\x6e\x6f\x20\x6f\x62\x76\x69\x6f\x75\x73\x20\x64",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\xcb\x06\x1f\x00\x00\x33\xce\x44\x07\xbd\x65\x66\x69\x63\x69\x65\x6e\x63\x69\x65\x73\x2e\x20\x28\x43\x2e\x41\x2e\x52\x2e\x20\x48\x6f\x61\x72\x65\x29",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x1d\x06\x1f\x00\x00\x35\xce\x44\x07\x11\x63\x74\x69\x6e\x67\x20\x61\x20\x73\x6f\x66\x74\x77\x61\x72\x65\x20\x64\x65\x73\x69\x67\x6e\x2e\x20\x20\x4f\x6e\x65",
        "\xab\xcd\x32\x24\x56\x80\x01\x11\xda\xbf\x20\x40\x00\x00\x3a\x06\x1f\x00\x00\x35\xce\x44\x07\x2e\x20\x77\x61\x79\x20\x69\x73\x20\x74\x6f\x20\x6d\x61\x6b\x65\x20\x69\x74\x20\x73\x6f\x20\x73\x69\x6d\x70\x6c\x65\x20",
    };
    unsigned int packets_len = 8;
    unsigned int message_len = 300;  // original message has 230 characters
    char *message_act = malloc(message_len*sizeof(char));

    // fill memory with "random" garbage
    srand(4321);
    for (unsigned int i = 0; i < message_len; i++)
        message_act[i] = (char)(rand() % 90 + 35);

    unsigned int num_packets_act = reconstruct_sf((unsigned char **)packets, packets_len, message_act, message_len);
    unsigned int num_packets_exp = 8;
    report_return_value(num_packets_act, num_packets_exp);
    free(message_act);
}
Test(grading_valgrind, reconstruct08) {
    expect_no_valgrind_errors(run_using_system("grading_reconstruct08"));
}


